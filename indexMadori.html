<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8" />
  <title>間取り分析＆3D表示</title>
  <link rel="stylesheet" href="styleMadori.css" />

  <!-- three.js を importmap + ES module で使う -->
  <script type="importmap">
    {
      "imports": {
        "three": "https://cdn.jsdelivr.net/npm/three@0.157.0/build/three.module.js",
        "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.157.0/examples/jsm/"
      }
    }
  </script>

  <!-- Google ログイン -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>

<body>
  <div class="container">
    <!-- 左：メインエリア（青） -->
    <div class="left-pane">
      <!-- 間取り画像を選んで分析 -->
      <section class="card card-blue">
        <h2 class="section-title">間取り画像を選んで分析</h2>
        <div class="analyze-controls">
          <div class="file-input-wrapper">
            <input type="file" id="imageInput" accept="image/*" />
          </div>
          <input id="filenameInput" type="text" placeholder="保存名を入力" class="text-input" />
          <button id="analyzeBtn">Roboflowで分析</button>
          <button id="saveBtn" class="btn-save">Driveに保存</button>
          <select id="fileSelect" class="select-input">
            <option value="">読み込むファイルを選択</option>
          </select>
          <button id="loadBtn" class="btn-login">Driveから読み込み</button>
          <button id="deleteBtn" class="btn-delete">選択ファイルを削除</button>
        </div>
      </section>

      <!-- 3D 間取り & 家具配置（3Dビュー本体） -->
      <section class="card card-blue">
        <h2 class="section-title">3D間取り＆家具配置</h2>
        <div id="three-container" class="three-canvas"></div>
      </section>

    </div>

    <!-- 右：ツール＆アップロード＆JSON -->
    <aside class="right-pane">
      <!-- 物体生成 + 家具ライブラリ（赤） -->
      <section class="card tool-panel">
        <h2 class="section-title">物体生成（四角形）</h2>
        <div class="placebar">
          <label>幅x
            <input type="number" id="boxW" value="1" step="0.1">
          </label>
          <label>高y
            <input type="number" id="boxH" value="1" step="0.1">
          </label>
          <label>奥z
            <input type="number" id="boxD" value="1" step="0.1">
          </label>
          <button id="genBoxBtn">物体生成</button>
        </div>
        <div class="placebar" style="margin-top:6px;">
          <span id="placeStatus"
            style="font-size:12px;padding:4px 8px;background:#eef6ff;border:1px solid #cfe5ff;border-radius:6px;color:#1155cc;">
            ダブルクリックで選択
          </span>
          <button id="moveDoneBtn" disabled>完了</button>
          <button id="moveDeleteBtn" disabled>削除</button>
        </div>

        <h2 class="section-title" style="margin-top:12px;">家具ライブラリ</h2>
        <div id="libraryList" class="library-list"></div>
      </section>

      <!-- アップロード画像（黄） -->
      <section class="card upload-panel">
        <h3 class="section-title small collapsible-header" id="upload-header">アップロード画像</h3>
        <div id="upload-container" class="expanded">
          <img id="preview" alt="アップロード画像" />
        </div>
      </section>

      <!-- 分析結果 JSON（紫） -->
      <section class="card json-panel">
        <h3 class="section-title small collapsible-header" id="result-header">分析結果 JSON</h3>
        <div id="result-container" class="expanded">
          <pre id="result">まだ分析されていません</pre>
        </div>
      </section>
    </aside>
  </div>

  <!-- Google ログインボタン -->
  <div id="g_id_onload" data-client_id="479474446026-kej6f40kvfm6dsuvfeo5d4fm87c6god4.apps.googleusercontent.com"
    data-callback="handleCredentialResponse" data-scope="https://www.googleapis.com/auth/drive.file">
  </div>
  <div class="g_id_signin" data-type="standard"></div>

  <script type="module" src="scriptMadori.js"></script>
</body>

</html>
